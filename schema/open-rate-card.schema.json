{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/connexcs/open-rate-card/schema/v1.0.0",
  "title": "Open Rate Card Specification",
  "description": "A standardized JSON format for telecommunications rate cards, enabling automated exchange of pricing, routing, and service information between VoIP carriers and wholesale providers.",
  "type": "object",
  "required": ["name", "schema_version", "version", "date", "cards"],
  "additionalProperties": true,
  "properties": {
    "name": {
      "type": "string",
      "description": "The name of the rate card or provider",
      "minLength": 1
    },
    "description": {
      "type": "string",
      "description": "A brief description of the rate card"
    },
    "version": {
      "type": "string",
      "description": "The version of this specific rate card document",
      "pattern": "^[0-9]+\\.[0-9]+(\\.[0-9]+)?$"
    },
    "schema_version": {
      "type": "string",
      "description": "The version of the Open Rate Card specification being used",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
    },
    "author": {
      "type": "string",
      "description": "The author or organization that created this rate card"
    },
    "website": {
      "type": "string",
      "format": "uri",
      "description": "Website URL of the provider"
    },
    "email": {
      "$ref": "#/$defs/EmailAddress",
      "description": "General contact email address"
    },
    "technical": {
      "$ref": "#/$defs/EmailAddress",
      "description": "Technical support contact email"
    },
    "noc": {
      "$ref": "#/$defs/EmailAddress",
      "description": "Network Operations Center (NOC) contact email"
    },
    "billing": {
      "$ref": "#/$defs/EmailAddress",
      "description": "Billing department contact email"
    },
    "phone": {
      "$ref": "#/$defs/E164Phone",
      "description": "Contact phone number in E.164 format"
    },
    "date": {
      "type": "string",
      "format": "date",
      "description": "Date this rate card was created (YYYY-MM-DD)"
    },
    "effective_date": {
      "$ref": "#/$defs/ISO8601DateTime",
      "description": "Date and time when this rate card becomes effective"
    },
    "expiry_date": {
      "$ref": "#/$defs/ISO8601DateTime",
      "description": "Date and time when this rate card expires"
    },
    "timezone": {
      "type": "string",
      "description": "IANA timezone identifier (e.g., UTC, America/New_York)"
    },
    "legal": {
      "type": "object",
      "additionalProperties": true,
      "description": "Legal terms and conditions",
      "properties": {
        "terms_url": {
          "type": "string",
          "format": "uri",
          "description": "URL to terms and conditions"
        },
        "privacy_url": {
          "type": "string",
          "format": "uri",
          "description": "URL to privacy policy"
        },
        "jurisdiction": {
          "$ref": "#/$defs/CountryCode",
          "description": "Legal jurisdiction country code"
        },
        "dispute_resolution": {
          "type": "string",
          "enum": ["arbitration", "litigation", "mediation"],
          "description": "Method for resolving disputes"
        },
        "liability_cap": {
          "type": "number",
          "minimum": 0,
          "description": "Maximum liability amount in USD"
        },
        "indemnification": {
          "type": "boolean",
          "description": "Whether indemnification is required"
        }
      }
    },
    "endpoints": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/$defs/Endpoint"
      },
      "description": "Named SIP/VoIP endpoints for routing traffic"
    },
    "cards": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/$defs/Card"
      },
      "description": "Rate cards containing pricing and routing information",
      "minProperties": 1
    },
    "customer": {
      "type": "object",
      "additionalProperties": true,
      "description": "Customer information",
      "properties": {
        "name": {
          "type": "string",
          "description": "Customer name"
        },
        "account_id": {
          "type": "string",
          "description": "Customer account identifier"
        },
        "contact_name": {
          "type": "string",
          "description": "Primary contact name"
        },
        "contact_email": {
          "$ref": "#/$defs/EmailAddress",
          "description": "Primary contact email"
        },
        "contact_phone": {
          "$ref": "#/$defs/E164Phone",
          "description": "Primary contact phone"
        },
        "billing_email": {
          "$ref": "#/$defs/EmailAddress",
          "description": "Billing contact email"
        },
        "technical_email": {
          "$ref": "#/$defs/EmailAddress",
          "description": "Technical contact email"
        },
        "address": {
          "type": "object",
          "additionalProperties": true,
          "properties": {
            "street": { "type": "string" },
            "city": { "type": "string" },
            "state": { "type": "string" },
            "postal_code": { "type": "string" },
            "country": { "$ref": "#/$defs/CountryCode" }
          }
        },
        "tax_id": {
          "type": "string",
          "description": "Tax identification number"
        },
        "customer_type": {
          "type": "string",
          "enum": ["carrier", "enterprise", "reseller", "retail", "other"],
          "description": "Type of customer"
        }
      }
    },
    "metadata": {
      "type": "object",
      "additionalProperties": true,
      "description": "File metadata and tracking information",
      "properties": {
        "created_at": {
          "$ref": "#/$defs/ISO8601DateTime",
          "description": "Timestamp when this document was created"
        },
        "updated_at": {
          "$ref": "#/$defs/ISO8601DateTime",
          "description": "Timestamp when this document was last updated"
        },
        "created_by": {
          "$ref": "#/$defs/EmailAddress",
          "description": "Email of the person who created this document"
        },
        "checksum": {
          "type": ["string", "null"],
          "description": "Checksum for document integrity verification"
        },
        "signature": {
          "type": ["string", "null"],
          "description": "Cryptographic signature for document authenticity"
        },
        "notes": {
          "type": "string",
          "description": "Additional notes or comments"
        }
      }
    }
  },
  "$defs": {
    "EmailAddress": {
      "type": "string",
      "pattern": "^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$",
      "description": "Valid email address"
    },
    "E164Phone": {
      "type": "string",
      "pattern": "^\\+?[1-9][0-9\\-\\s\\.\\(\\)]{1,20}$",
      "description": "Phone number in E.164 format (allows common formatting)"
    },
    "ISO8601DateTime": {
      "type": "string",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d{3})?Z$",
      "description": "ISO 8601 date-time string"
    },
    "CountryCode": {
      "type": "string",
      "pattern": "^[A-Z]{2}$",
      "description": "ISO 3166-1 alpha-2 country code"
    },
    "CurrencyCode": {
      "type": "string",
      "pattern": "^[A-Z]{3}$",
      "description": "ISO 4217 currency code"
    },
    "Endpoint": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "protocol": {
          "type": "string",
          "enum": ["sip", "h323", "iax2", "webrtc"],
          "description": "Signaling protocol"
        },
        "transport": {
          "type": "string",
          "enum": ["udp", "tcp", "tls", "ws", "wss"],
          "description": "Transport protocol"
        },
        "host": {
          "type": "string",
          "description": "Hostname or IP address"
        },
        "port": {
          "type": "integer",
          "minimum": 1,
          "maximum": 65535,
          "description": "Port number"
        },
        "username": {
          "type": "string",
          "description": "Authentication username"
        },
        "password": {
          "type": "string",
          "description": "Authentication password"
        },
        "priority": {
          "type": "integer",
          "minimum": 0,
          "description": "Endpoint priority for failover (lower is higher priority)"
        }
      }
    },
    "Card": {
      "type": "object",
      "required": ["name", "type", "currency", "endpoint"],
      "additionalProperties": true,
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of this rate card",
          "minLength": 1
        },
        "description": {
          "type": "string",
          "description": "Description of this rate card"
        },
        "type": {
          "type": "string",
          "enum": ["termination", "origination", "messaging", "wholesale", "retail", "did", "toll_free"],
          "description": "Type of rate card"
        },
        "direction": {
          "type": "string",
          "enum": ["outbound", "inbound", "bidirectional"],
          "description": "Traffic direction"
        },
        "traffic_type": {
          "type": "string",
          "enum": ["voice", "sms", "mms", "fax", "data", "video"],
          "description": "Type of traffic"
        },
        "service_type": {
          "type": "string",
          "enum": ["wholesale", "retail", "did", "toll_free", "premium"],
          "description": "Service classification"
        },
        "currency": {
          "$ref": "#/$defs/CurrencyCode",
          "description": "Currency code for all rates in this card"
        },
        "endpoint": {
          "type": "string",
          "description": "Reference to the endpoint name in the endpoints section"
        },
        "tech_prefix": {
          "type": "string",
          "description": "Technical prefix to be used for routing"
        },
        "fields": {
          "type": "array",
          "description": "Field definitions for the rates array columns",
          "items": {
            "type": "object",
            "required": ["name"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Field name"
              }
            }
          }
        },
        "rate": {
          "type": "object",
          "additionalProperties": true,
          "description": "Default rate configuration",
          "properties": {
            "precision": {
              "type": "integer",
              "minimum": 0,
              "maximum": 10,
              "description": "Number of decimal places for rates"
            },
            "rounding": {
              "type": "string",
              "enum": ["up", "down", "nearest", "half_up", "half_down"],
              "description": "Rounding method for rate calculations"
            },
            "default_pulse": {
              "type": "integer",
              "minimum": 1,
              "description": "Default billing pulse in seconds"
            },
            "default_initial": {
              "type": "integer",
              "minimum": 1,
              "description": "Default initial interval in seconds"
            },
            "connection": {
              "type": "number",
              "minimum": 0,
              "description": "Default connection fee"
            }
          }
        },
        "charge": {
          "type": "object",
          "additionalProperties": true,
          "description": "Charge calculation settings",
          "properties": {
            "precision": {
              "type": "integer",
              "minimum": 0,
              "maximum": 10,
              "description": "Number of decimal places for charges"
            },
            "rounding": {
              "type": "string",
              "enum": ["up", "down", "nearest", "half_up", "half_down"],
              "description": "Rounding method for charge calculations"
            }
          }
        },
        "rates": {
          "type": "array",
          "description": "2D array of rate data, where each row corresponds to the fields array",
          "items": {
            "type": "array",
            "description": "Single rate entry matching the fields definition"
          }
        },
        "criteria": {
          "type": "array",
          "description": "Quality criteria and requirements",
          "items": {
            "type": "object",
            "additionalProperties": true,
            "properties": {
              "acd": {
                "type": "integer",
                "minimum": 0,
                "description": "Average Call Duration in seconds"
              },
              "asr": {
                "type": "integer",
                "minimum": 0,
                "maximum": 100,
                "description": "Answer Seizure Ratio as percentage"
              },
              "pre_assert_id": {
                "type": "string",
                "enum": ["required", "optional", "none"],
                "description": "P-Asserted-Identity requirement"
              },
              "stir_shaken_attestation": {
                "type": "string",
                "enum": ["A", "B", "C"],
                "description": "STIR/SHAKEN attestation level"
              },
              "cli_required": {
                "type": "boolean",
                "description": "Whether CLI is required"
              }
            }
          }
        },
        "performance": {
          "type": "object",
          "additionalProperties": true,
          "description": "Performance SLA metrics",
          "properties": {
            "ner": {
              "type": "number",
              "minimum": 0,
              "maximum": 100,
              "description": "Network Effectiveness Ratio as percentage"
            },
            "uptime": {
              "type": "number",
              "minimum": 0,
              "maximum": 100,
              "description": "Service uptime percentage"
            },
            "cps": {
              "type": "integer",
              "minimum": 0,
              "description": "Calls Per Second capacity"
            },
            "channels": {
              "type": "integer",
              "minimum": 0,
              "description": "Number of available channels"
            },
            "concurrent_calls": {
              "type": "integer",
              "minimum": 0,
              "description": "Maximum concurrent calls"
            },
            "pdd": {
              "type": "integer",
              "minimum": 0,
              "description": "Post Dial Delay in seconds"
            },
            "latency": {
              "type": "integer",
              "minimum": 0,
              "description": "Network latency in milliseconds"
            },
            "jitter": {
              "type": "integer",
              "minimum": 0,
              "description": "Jitter in milliseconds"
            },
            "packet_loss": {
              "type": "number",
              "minimum": 0,
              "maximum": 100,
              "description": "Packet loss percentage"
            },
            "mos_min": {
              "type": "number",
              "minimum": 1.0,
              "maximum": 5.0,
              "description": "Minimum Mean Opinion Score"
            },
            "sla_response_time_minutes": {
              "type": "integer",
              "minimum": 0,
              "description": "SLA response time in minutes"
            }
          }
        },
        "codecs": {
          "type": "array",
          "description": "Supported audio codecs",
          "items": {
            "oneOf": [
              {
                "type": "string",
                "description": "Simple codec name"
              },
              {
                "type": "object",
                "required": ["name"],
                "additionalProperties": true,
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Codec name"
                  },
                  "min_bitrate": {
                    "type": "integer",
                    "minimum": 0,
                    "description": "Minimum bitrate in bps"
                  },
                  "max_bitrate": {
                    "type": "integer",
                    "minimum": 0,
                    "description": "Maximum bitrate in bps"
                  },
                  "channels": {
                    "type": "integer",
                    "minimum": 1,
                    "description": "Number of audio channels"
                  },
                  "ptime": {
                    "type": "integer",
                    "minimum": 1,
                    "description": "Packet time in milliseconds"
                  }
                }
              }
            ]
          }
        },
        "number_format": {
          "type": "object",
          "additionalProperties": true,
          "description": "Number format requirements",
          "properties": {
            "src": {
              "type": "object",
              "additionalProperties": true,
              "description": "Source number format",
              "properties": {
                "e164": { "type": "boolean" },
                "national": { "type": "boolean" },
                "international": { "type": "boolean" }
              }
            },
            "dst": {
              "type": "object",
              "additionalProperties": true,
              "description": "Destination number format",
              "properties": {
                "e164": { "type": "boolean" },
                "national": { "type": "boolean" },
                "international": { "type": "boolean" }
              }
            }
          }
        }
      }
    }
  },
  "examples": [
    {
      "name": "Minimal Termination Card",
      "schema_version": "1.0.0",
      "version": "1.0",
      "date": "2026-01-03",
      "cards": {
        "default": {
          "name": "Basic Termination",
          "type": "termination",
          "currency": "USD",
          "endpoint": "default"
        }
      }
    },
    {
      "name": "Minimal Origination Card",
      "schema_version": "1.0.0",
      "version": "1.0",
      "date": "2026-01-03",
      "cards": {
        "origination": {
          "name": "Basic Origination",
          "type": "origination",
          "currency": "USD",
          "endpoint": "default"
        }
      }
    },
    {
      "name": "Minimal Messaging Card",
      "schema_version": "1.0.0",
      "version": "1.0",
      "date": "2026-01-03",
      "cards": {
        "messaging": {
          "name": "Basic SMS",
          "type": "messaging",
          "currency": "USD",
          "endpoint": "default"
        }
      }
    }
  ]
}
